 -- FyyCommunity Loader (tanpa JSONDecode, parsing manual)
local HttpService = game:GetService("HttpService")

local API_URL = "https://loretta-metalline-bebe.ngrok-free.dev/validate"

local function validateKey()
    if not _G.script_key then
        error("[Fyy Loader] _G.script_key belum di-set")
    end

    local hwid = game:GetService("RbxAnalyticsService"):GetClientId()
    local player = game.Players.LocalPlayer
    local robloxId = player and player.UserId or 0
    local placeId = game.PlaceId

    local url = string.format(
        "%s?key=%s&hwid=%s&robloxId=%s&placeId=%s",
        API_URL,
        HttpService:UrlEncode(_G.script_key),
        HttpService:UrlEncode(hwid),
        tostring(robloxId),
        tostring(placeId)
    )

    -- HTTP GET + pcall
    local ok, response = pcall(function()
        return game:HttpGet(url)
    end)

    if not ok or not response or response == "" then
        if player then
            player:Kick("[Fyy Loader] Tidak bisa menghubungi server validasi.")
        end
        return
    end

    -- DEBUG: liatin beberapa karakter awal biar tau bentuk respon
    warn("[Fyy Loader] RAW RESPONSE (potongan):")
    warn(string.sub(response, 1, 200))

    -- ===== PARSE MANUAL TANPA JSONDECODE =====
    -- cari "status":"..."
    local status = response:match([["status"%s*:%s*"(.-)"]])
    -- cari "message":"..."
    local message = response:match([["message"%s*:%s*"(.-)"]])
    -- cari "code":"..."
    local code = response:match([["code"%s*:%s*"(.-)"]])

    if not status then
        -- beneran bukan respon API kita
        if player then
            player:Kick("[Fyy Loader] Response server tidak valid.")
        end
        return
    end

    if status ~= "ok" then
        if player then
            player:Kick("[Fyy Loader] " .. (message or "Key error (" .. (code or "UNKNOWN") .. ")"))
        end
        return
    end

    print("[Fyy Loader] Validation OK:", code or "OK", message or "")
end

validateKey()

print("[Fyy Loader] Script premium mulai jalan untuk key:", _G.script_key)

loadstring(game:HttpGet("https://raw.githubusercontent.com/fyywannafly-sudo/panel/refs/heads/main/FyyCommunity"))()
